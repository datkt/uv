#!/bin/sh
## borrowed from https://github.com/uv-friends/uv-native/blob/master/configure
PREFIX="${PREFIX:-$PWD}"
KONAN="${KONAN:-$HOME/.konan}"

cd libuv

! [ -f autogen.sh ] && echo 'You need to run "npm run fetch-libuv" first' && exit 1
./autogen.sh

if [ -z "$SYSROOT" ]; then
  case $(uname -a) in
    **x86_64**)
      export CC="$KONAN/dependencies/clang-llvm-*-x86-64/bin/clang"
      ;;
  esac
fi

./configure --prefix=$PREFIX "$@"
make install
